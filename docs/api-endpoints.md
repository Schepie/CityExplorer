# API Endpoints & Network Traffic Documentation

This document provides a comprehensive overview of all external API calls and outgoing network traffic generated by the CityExplorer application.

---

## üåê External API Services

### 1. Routing & Navigation

#### **OSRM (OpenStreetMap Routing Machine)**
- **Base URL:** `https://routing.openstreetmap.de/`
- **Endpoints:**
  - `/routed-foot/route/v1/foot/...` - Walking routes
  - `/routed-bike/route/v1/bike/...` - Cycling routes
- **Purpose:** Calculate optimal route paths between waypoints
- **Frequency:** Every route calculation/update
- **Data Sent:** 
  - Waypoint coordinates (lat/lng)
  - Route preferences (loop/point-to-point)
- **Response:** Route geometry, turn-by-turn instructions, distance, duration
- **Used in:** `App.jsx` - `calculateRoutePath()`

---

### 2. Geocoding Services

#### **Photon (Komoot)**
- **Base URL:** `https://photon.komoot.io/api/`
- **Endpoint:** `/?q={query}&limit=5&lang={language}`
- **Purpose:** Convert place names to coordinates, city search
- **Frequency:** User searches for cities/locations
- **Data Sent:** Search query string, language preference
- **Response:** List of matching locations with coordinates
- **Used in:** 
  - `App.jsx` - City search
  - `geocoding.js` - General geocoding

#### **Open-Meteo Geocoding API**
- **Base URL:** `https://geocoding-api.open-meteo.com/`
- **Endpoint:** `/v1/search?name={query}&count=5&language={lang}&format=json`
- **Purpose:** Alternative geocoding service
- **Frequency:** Fallback when Photon fails
- **Data Sent:** Location name, language
- **Response:** Location matches with coordinates
- **Used in:** 
  - `App.jsx` - Location search fallback
  - `geocoding.js`

#### **BigDataCloud Reverse Geocoding**
- **Base URL:** `https://api.bigdatacloud.net/`
- **Endpoint:** `/data/reverse-geocode-client?latitude={lat}&longitude={lng}&localityLanguage={lang}`
- **Purpose:** Convert coordinates back to human-readable addresses
- **Frequency:** When user picks a point on the map
- **Data Sent:** Latitude, longitude, language preference
- **Response:** Formatted address, city name, country
- **Used in:** `App.jsx` - Map point selection

#### **ipapi.co**
- **Base URL:** `https://ipapi.co/`
- **Endpoint:** `/json/`
- **Purpose:** Detect user's approximate location from IP address
- **Frequency:** Once on app startup (if location not available)
- **Data Sent:** None (IP detected automatically)
- **Response:** Country, city, approximate coordinates
- **Used in:** `App.jsx` - Initial location detection

---

### 3. Weather Data

#### **Open-Meteo Weather API**
- **Base URL:** `https://api.open-meteo.com/`
- **Endpoint:** `/v1/forecast?latitude={lat}&longitude={lng}&current_weather=true&daily=...&hourly=...&timezone=auto&forecast_days=7`
- **Purpose:** Current weather and 7-day forecast for route
- **Frequency:** Once per route planning
- **Data Sent:** Route center coordinates
- **Response:** Weather conditions, temperature, forecasts
- **Used in:** `ItinerarySidebar.jsx` - Weather card display

---

### 4. Points of Interest (POI) Discovery

#### **Overpass API (OpenStreetMap)** ‚≠ê *Default Service*
- **Base URL:** `https://overpass-api.de/api/interpreter`
- **Failover Mirrors:**
  - `https://overpass.kumi.systems/api/interpreter`
  - `https://maps.mail.ru/osm/tools/overpass/api/interpreter`
- **Method:** GET (optimized exact match queries)
- **Purpose:** Query OpenStreetMap database for POIs using `nwr` geometry.
- **Failover Logic**: Automatically rotates between mirrors on 429 (Rate Limit) or 504 (Timeout) errors.
- **Used in:** `poiService.js` - POI discovery

---

### 5. Content & Information Enrichment

#### **Wikipedia REST API**
- **Base URLs:** 
  - `https://en.wikipedia.org/api/rest_v1/`
  - `https://nl.wikipedia.org/api/rest_v1/`
- **Endpoint:** `/page/summary/{title}`
- **Purpose:** Fetch descriptions, images, and summaries for landmarks
- **Frequency:** For each POI requiring enrichment
- **Data Sent:** Article title/name
- **Response:** Summary text, images, coordinates, extract
- **Used in:** 
  - `ItinerarySidebar.jsx` - City information
  - `PoiIntelligence.js` - POI enrichment

#### **DuckDuckGo Instant Answer API**
- **Purpose:** Additional POI information and facts
- **Frequency:** POI enrichment fallback
- **Used in:** `App.jsx` - POI details enrichment

---

### 6. AI & Content Generation (Free Layer)

#### **Groq Cloud (Llama 70B)** ‚≠ê *Default Service*
- **Endpoint:** `/api/groq` (via your backend proxy)
- **Purpose:** Fast, high-quality POI descriptions, summaries, and insights using Llama-3.
- **Frequency:** For each POI requiring AI-generated content.
- **Resilience**: Implements exponential backoff retries (5 attempts) for 429 rate limits.
- **Used in:** 
  - `PoiIntelligence.js` - Core enrichment engine
  - `App.jsx` - POI enrichment workflow

#### **Google Gemini AI** (Premium Option)
- **Endpoint:** `/api/gemini` (via your backend proxy)
- **Purpose:** Premium alternative for content generation.
- **Toggle:** User can switch in Settings.

---

### 7. Search & Signal Gathering

#### **Tavily AI Search** ‚≠ê *Default Service*
- **Endpoint:** `/api/tavily` (via your backend proxy)
- **Purpose:** Web search specifically optimized for AI agents to gather POI context.
- **Frequency:** During POI enrichment to gather signals (Wikipedia fallback).
- **Used in:** `PoiIntelligence.js` - `fetchTavilySearch()`

#### **Google Custom Search** (Premium Option)
- **Endpoint:** `/api/google-search` (via your backend proxy)
- **Purpose:** Premium web search fallback.

---

### 7. Google Services

#### **Google Places API**
- **Endpoint:** `/api/google-places` (via your backend proxy)
- **Original API:** `https://maps.googleapis.com/maps/api/place/...`
- **Purpose:** Discover POIs and fetch place details
- **Frequency:** During POI search/discovery
- **Data Sent:** Location coordinates, search radius, interest keywords
- **Response:** List of places with names, coordinates, types, ratings
- **Used in:** 
  - `poiService.js` - `fetchGooglePOIs()`
  - Combined with OSM and Foursquare results

#### **Google Custom Search API**
- **Endpoint:** `/api/google-search` (via your backend proxy)
- **Purpose:** Web search for POI information and context
- **Frequency:** During POI enrichment to gather additional signals
- **Data Sent:** Search query (POI name + city context)
- **Response:** Search results with snippets, links, metadata
- **Used in:** 
  - `PoiIntelligence.js` - `fetchGoogleSearch()`
  - `App.jsx` - Content enrichment fallback

#### **Google Knowledge Graph API** (Optional/Disabled)
- **Endpoint:** `https://kgsearch.googleapis.com/v1/entities:search`
- **Purpose:** Structured data about entities (landmarks, famous places)
- **Status:** Currently commented out in code
- **Used in:** `PoiIntelligence.js` - `fetchGoogleKnowledgeGraph()` (disabled)

---

### 8. Map Rendering

#### **MapTiler / MapLibre Tiles**
- **Purpose:** Base map tiles for rendering
- **Frequency:** Continuous (as user pans/zooms)
- **Data Sent:** Tile coordinates, zoom level
- **Response:** Map tile images
- **Used in:** `MapLibreContainer.jsx` via MapLibre GL

---

### 9. Authentication & Backend APIs

Your own backend API endpoints:

#### **Authentication Endpoints**
- `/api/auth-validate` - Validate existing JWT token
- `/api/auth-request-link` - Request magic link login
- `/api/auth-verify-link` - Verify magic link token
- `/api/auth-verify-code` - Verify 6-digit access code

**Purpose:** User authentication and authorization
**Frequency:** On app startup, during login
**Data Sent:** Email, codes, tokens
**Used in:** `AuthContext.jsx`

---

## üìä Network Traffic Patterns

### High-Frequency Calls
| Service | Frequency | Trigger |
|---------|-----------|---------|
| **Google Gemini AI** | Per POI enrichment | POI discovery, content generation |
| OSRM Routing | Per route change | Route calculation, POI add/remove |
| Overpass API | Per discovery | "Discover POIs" button, interest search |
| Wikipedia | Per POI | POI enrichment (signal gathering) |
| **Google Custom Search** | Per POI | POI information gathering |
| Google Places | Per discovery | POI search alongside OSM |
| Map Tiles | Continuous | Map pan/zoom |

### Medium-Frequency Calls
| Service | Frequency | Trigger |
|---------|-----------|---------|
| Geocoding (Photon/Open-Meteo) | Per search | City/location search |
| Weather API | Once per route | Route planning |
| Reverse Geocoding | Per map pick | User picks point on map |

### Low-Frequency Calls
| Service | Frequency | Trigger |
|---------|-----------|---------|
| IP Geolocation | Once on startup | Initial location detection |
| Auth endpoints | Per session | Login/authentication |

---

## üîí Privacy & Data Considerations

### ‚úÖ Privacy-Respecting Design
- **No tracking pixels or analytics** - No Google Analytics, Facebook Pixel, or similar
- **No advertising networks** - No third-party ad services
- **Open-source APIs** - Most services are community-driven and privacy-focused
- **Minimal data collection** - Only necessary location/search data sent to APIs

### ‚ö†Ô∏è Data Shared with External Services
1. **Location Coordinates**
   - Sent to: OSRM, geocoding services, weather API, Overpass
   - Purpose: Route calculation, POI discovery, weather data
   
2. **Search Queries**
   - Sent to: Photon, Open-Meteo, Wikipedia
   - Purpose: Location search, content enrichment

3. **IP Address**
   - Sent to: ipapi.co (only on startup if needed)
   - Purpose: Approximate location detection

### üõ°Ô∏è Security Measures
- All API calls use **HTTPS** encryption
- JWT authentication for backend API
- No sensitive user data stored in external services
- Token-based authentication (no passwords sent over network)

---

## üîß Technical Implementation

### Request Flow
```
User Action ‚Üí App Component ‚Üí API Service ‚Üí External API
                                    ‚Üì
                        Response Processing
                                    ‚Üì
                        State Update ‚Üí UI Render
```

### Key Files
- **`src/App.jsx`** - Main routing and geocoding logic
- **`src/utils/poiService.js`** - POI discovery via Overpass
- **`src/utils/geocoding.js`** - Geocoding utilities
- **`src/utils/api.js`** - Authenticated fetch wrapper
- **`src/services/PoiIntelligence.js`** - Smart POI selection and enrichment
- **`src/contexts/AuthContext.jsx`** - Authentication flow

### Error Handling
All API calls include:
- Try-catch error handling
- Console logging for debugging
- Graceful fallbacks (e.g., Photon ‚Üí Open-Meteo for geocoding)
- Timeout handling via AbortController

---

## üìù Notes for Developers

### Adding New APIs
When integrating a new external API:
1. Document the endpoint in this file
2. Add error handling and fallbacks
3. Consider privacy implications
4. Test with network throttling
5. Implement request caching where appropriate

### Rate Limiting
Most services used are free and have rate limits:
- **Overpass API:** ~10,000 queries/day recommended
- **OSRM:** No strict limit, but be reasonable
- **Wikipedia:** Rate-limited to ~200 requests/second per IP

### Offline Considerations
The app requires network connectivity for:
- Initial route calculation
- POI discovery
- Content enrichment

Consider implementing:
- Route caching for offline use
- Cached map tiles
- Pre-downloaded POI data for popular cities

---

## üìÖ Last Updated
**Date:** February 12, 2026  
**Version:** v3.1.1

For questions or updates to this documentation, please contact the development team.
